<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NellyCoin ‚Äî Staking</title>
  <meta name="description" content="Staker vos NLY sur BNB Smart Chain. Multi-wallet (MetaMask, Binance Wallet, WalletConnect). Les plans s‚Äôaffichent apr√®s connexion. Adresse affich√©e = contrat token NLY (pas staking)." />
  <meta name="theme-color" content="#0b1020" />
  <link rel="manifest" href="/manifest.webmanifest" />
  <link rel="icon" href="/assets/nelly/logo.png" />

  <!-- WalletConnect v2 (prioritaire) -->
  <script src="https://unpkg.com/@walletconnect/ethereum-provider@2/dist/index.umd.min.js"></script>
  <!-- Fallback WalletConnect v1 (si v2 indisponible) -->
  <script src="https://unpkg.com/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>

  <style>
    :root{--bg:#0b1020;--panel:#0f1631;--card:#121a38;--muted:#c7d2ea;--txt:#fff;--accent:#f6b449;--accent-2:#ffd36a;--ok:#22c55e;--down:#ef4444;--border:rgba(255,255,255,.22);--shadow:0 10px 30px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.08)}
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:radial-gradient(900px 520px at 15% -10%, #1a2454 0%, transparent 60%),radial-gradient(900px 520px at 120% 10%, #401c48 0%, transparent 55%),linear-gradient(180deg,#0b1020 0%,#090e1a 100%);color:var(--txt);font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Arial;line-height:1.6;overflow-x:hidden}
    a{color:var(--accent);text-decoration:none}
    img{max-width:100%;height:auto;display:block}
    .container{width:min(1200px,94%);margin-inline:auto}

    /* Header + nav */
    header{position:sticky;top:0;z-index:60;backdrop-filter:saturate(140%) blur(10px);background:linear-gradient(180deg,rgba(11,16,32,.92),rgba(11,16,32,.55));border-bottom:1px solid var(--border)}
    .nav{display:flex;align-items:center;gap:10px;padding:10px 0}
    .brand{display:flex;align-items:center;gap:10px}
    .brand img{width:44px;height:44px;border-radius:10px;box-shadow:0 0 24px rgba(246,180,73,.25)}
    .brand span{font-weight:900;letter-spacing:.6px}
    nav.main{display:flex;gap:12px;align-items:center}
    nav.main a{position:relative;color:var(--txt);padding:8px}
    nav.main a:after{content:'';position:absolute;left:12px;right:12px;bottom:6px;height:2px;background:transparent;border-radius:4px;transition:background .18s}
    nav.main a:hover:after,nav.main a.active:after{background:linear-gradient(90deg,var(--accent),var(--accent-2))}
    .spacer{flex:1}
    .btn{cursor:pointer;display:inline-flex;align-items:center;gap:8px;padding:11px 14px;border-radius:12px;border:1px solid var(--border);background:linear-gradient(180deg,rgba(255,255,255,.22),rgba(255,255,255,.08));color:#0e1116;font-weight:800;box-shadow:var(--shadow);transition:transform .15s, box-shadow .2s}
    .btn:hover{transform:translateY(-1px);box-shadow:0 12px 30px rgba(246,180,73,.18), inset 0 1px 0 rgba(255,255,255,.12)}
    .btn.accent{background:linear-gradient(180deg,var(--accent-2),var(--accent));color:#1a1303;border-color:rgba(255,211,106,.85)}
    .btn.ghost{background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02));color:var(--txt)}
    .btn.sm{padding:8px 10px;border-radius:10px;font-weight:700}
    .btn.disabled,.disabled .btn{opacity:.5;pointer-events:none;filter:grayscale(30%)}
    .lang-select{border:1px solid var(--border);padding:8px 10px;border-radius:10px;background:#fff;color:#0e1116;font-weight:800}
    .panel{background:linear-gradient(180deg,rgba(255,255,255,.10),rgba(255,255,255,.05));border:1px solid var(--border);border-radius:16px;padding:16px;box-shadow:var(--shadow)}
    .card{border:1px solid var(--border);background:linear-gradient(180deg,rgba(255,255,255,.10),rgba(255,255,255,.04));border-radius:14px;padding:14px;box-shadow:var(--shadow)}
    .grid-2{display:grid;grid-template-columns:1.2fr .8fr;gap:20px}
    .plans{display:grid;grid-template-columns:repeat(2,1fr);gap:14px}
    .muted{color:var(--muted)}
    .pill{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--border);border-radius:999px;padding:6px 10px;background:rgba(255,255,255,.06)}
    .status.warn{border-color:#f59e0b;color:#f59e0b;background:rgba(245,158,11,.1)}
    .status.ok{border-color:#22c55e;color:#22c55e;background:rgba(34,197,94,.12)}
    input[type="number"],input[type="text"]{width:100%;padding:10px 12px;border-radius:10px;border:1px solid var(--border);background:rgba(255,255,255,.06);color:var(--txt)}
    .hidden{display:none!important}

    /* Hamburger mobile */
    #menuToggle{display:none}
    @media (max-width:980px){
      nav.main{display:none;position:fixed;inset:64px 10px auto 10px;flex-direction:column;gap:6px;padding:14px;border:1px solid var(--border);border-radius:12px;background:rgba(11,16,32,.98)}
      nav.main.open{display:flex}
      #menuToggle{display:inline-flex}
      .grid-2{grid-template-columns:1fr}
      .plans{grid-template-columns:1fr}
      .nav{flex-wrap:wrap}
    }

    /* Modal wallets */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;padding:16px}
    .modal.open{display:flex}
    .modal .box{width:min(480px,96%);background:#0f1631;border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow);padding:14px}
    .wallet-list{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .wallet-btn{display:flex;align-items:center;gap:10px;padding:12px;border-radius:12px;border:1px solid var(--border);background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02));color:var(--txt);cursor:pointer}
    .wallet-btn:hover{border-color:var(--accent)}

    /* Encadr√© jaune SamDoge-like */
    .notice{border:1px solid #f59e0b;background:rgba(245,158,11,.1);border-radius:14px;padding:12px}
  </style>
</head>
<body>
  <!-- HEADER -->
  <header>
    <div class="container nav">
      <a class="brand" href="/index.html" aria-label="NellyCoin Home">
        <img src="/assets/nelly/logo.png" alt="NellyCoin logo"/>
        <span>NellyCoin (NLY)</span>
      </a>

      <button id="menuToggle" class="btn ghost" aria-label="Menu">‚ò∞</button>

      <nav class="main" id="mainNav" aria-label="Main navigation">
        <a href="/index.html#about" data-i18n="nav.about">√Ä propos</a>
        <a href="/index.html#tokenomics" data-i18n="nav.tokenomics">Tokenomics</a>
        <a href="/index.html#howto" data-i18n="nav.howto">Comment acheter</a>
        <a href="/index.html#roadmap" data-i18n="nav.roadmap">Feuille de route</a>
        <a href="/index.html#links" data-i18n="nav.links">Liens</a>
        <a class="active" href="/staking.html" data-i18n="nav.staking">Staking</a>
        <a href="/faq.html" data-i18n="nav.faq">FAQ</a>
      </nav>

      <div class="spacer"></div>
      <a class="btn accent" id="buyBtn" target="_blank" rel="noopener">üí± <span data-i18n="nav.buy">Acheter NLY</span></a>
      <select id="lang" class="lang-select" title="Langue"><option value="fr">FR</option><option value="en">EN</option></select>
    </div>
  </header>

  <main class="container" style="padding:20px 0 30px">
    <!-- Bandeau statut + actions -->
    <div class="panel" style="display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap">
      <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
        <span id="stakingStatus" class="pill status warn" data-i18n="prep.msg">üõ†Ô∏è Staking en cours de pr√©paration ‚Äî disponible prochainement.</span>
        <span class="pill"><b>NLY</b> ‚Ä¢ BSC</span>
        <a class="pill" target="_blank" href="https://bscscan.com/token/0x4bFfd4359a06583713df160da5817737654804b5">üîç BscScan</a>
      </div>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <button id="connectBtn" class="btn accent">üîó <span data-i18n="btn.connect">Connecter</span></button>
        <button id="disconnectBtn" class="btn ghost">‚èèÔ∏é <span data-i18n="btn.disconnect">D√©connecter</span></button>
        <button id="toggleStake" class="btn hidden">üîì <span data-i18n="stake.enable">Activer le staking</span></button>
      </div>
    </div>

    <!-- Adresse contrat TOKEN (pas staking) -->
    <div class="panel" style="margin-top:12px">
      <h3 style="margin:0 0 6px">NLY ‚Äî <span data-i18n="addr.title">Adresse du contrat NellyCoin (token, pas staking)</span></h3>
      <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
        <code id="tokenAddr" style="font-weight:700">0x4bFfd4359a06583713df160da5817737654804b5</code>
        <button id="copyToken" class="btn sm">üìã <span data-i18n="btn.copy">Copier</span></button>
        <a class="btn sm" target="_blank" href="https://bscscan.com/token/0x4bFfd4359a06583713df160da5817737654804b5">üîç BscScan</a>
      </div>
      <small class="muted" data-i18n="addr.note">Ceci est l‚Äôadresse du jeton NLY. L‚Äôadresse du contrat de staking sera ajout√©e apr√®s d√©ploiement.</small>
    </div>

    <!-- Comment d√©marrer / Comment staker -->
    <section class="panel" style="margin-top:12px">
      <h2 style="margin:0 0 6px" id="howTitle" data-i18n="how.title">Comment d√©marrer ?</h2>

      <!-- Avant connexion -->
      <div id="howBefore">
        <ol class="muted" style="margin:6px 0 10px 18px">
          <li data-i18n="how.l1">Connectez votre wallet (MetaMask / Binance Wallet / WalletConnect) sur BSC.</li>
          <li data-i18n="how.l2">V√©rifiez le r√©seau (BSC Mainnet) et autorisez NLY pour le contrat de staking.</li>
          <li data-i18n="how.l3">Choisissez un plan (3/6/9/12 mois) et entrez le montant.</li>
          <li data-i18n="how.l4">Cliquez sur ‚ÄúApprouver‚Äù, puis ‚ÄúStaker‚Äù.</li>
          <li data-i18n="how.l5">√Ä la fin de la p√©riode, utilisez ‚ÄúR√©clamer‚Äù ou ‚ÄúExit‚Äù.</li>
        </ol>
        <div id="needConnect" class="pill status warn" data-i18n="how.warn">‚ö†Ô∏è Connectez votre wallet pour acc√©der aux plans de staking.</div>
      </div>

      <!-- Apr√®s connexion -->
      <div id="howAfter" class="hidden">
        <div class="notice">
          <b>ü™ô <span data-i18n="after.title">Comment staker vos NLY ?</span></b>
          <ol style="margin:8px 0 0 18px">
            <li data-i18n="after.l1">Choisissez un plan (3 / 6 / 9 / 12 mois).</li>
            <li data-i18n="after.l2">Cliquez sur ‚ÄúApprouver‚Äù, puis sur ‚ÄúStaker‚Äù.</li>
            <li data-i18n="after.l3">Validez la transaction dans votre wallet.</li>
            <li data-i18n="after.l4">En fin de p√©riode, utilisez ‚ÄúR√©clamer‚Äù ou ‚ÄúExit‚Äù.</li>
          </ol>
        </div>
      </div>
    </section>

    <!-- Deux colonnes -->
    <div class="grid-2" style="margin-top:16px">
      <!-- Colonne gauche : PLANS (2x2) -->
      <section>
        <div class="card" style="margin-bottom:12px">
          <h2 style="margin:0 0 6px" data-i18n="stake.title">Plans de staking</h2>
          <p class="muted" data-i18n="stake.subtitle">Choisissez une dur√©e. APY indicatif. Les r√©compenses se calculent sur la p√©riode.</p>
        </div>

        <div id="plansWrap" class="plans hidden">
          <div class="card plan" data-months="3" data-apy="8">
            <h3 style="margin:0">3 <span data-i18n="mo">mois</span> ‚Äî <b>8% APY</b></h3>
            <p class="muted" data-i18n="stake.lock3">Verrouillage 3 mois. Id√©al pour d√©marrer.</p>
            <label data-i18n="amount">Montant (NLY)</label>
            <input type="number" min="0" step="0.000001" placeholder="0.0" class="amt" />
            <div style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap">
              <button class="btn sm approve" data-i18n="btn.approve">Approuver</button>
              <button class="btn sm stake" data-i18n="btn.stake">Staker</button>
            </div>
          </div>

          <div class="card plan" data-months="6" data-apy="12">
            <h3 style="margin:0">6 <span data-i18n="mo">mois</span> ‚Äî <b>12% APY</b></h3>
            <p class="muted" data-i18n="stake.lock6">Verrouillage 6 mois. Rendement √©quilibr√©.</p>
            <label data-i18n="amount">Montant (NLY)</label>
            <input type="number" min="0" step="0.000001" placeholder="0.0" class="amt" />
            <div style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap">
              <button class="btn sm approve" data-i18n="btn.approve">Approuver</button>
              <button class="btn sm stake" data-i18n="btn.stake">Staker</button>
            </div>
          </div>

          <div class="card plan" data-months="9" data-apy="16">
            <h3 style="margin:0">9 <span data-i18n="mo">mois</span> ‚Äî <b>16% APY</b></h3>
            <p class="muted" data-i18n="stake.lock9">Verrouillage 9 mois. Pour holders engag√©s.</p>
            <label data-i18n="amount">Montant (NLY)</label>
            <input type="number" min="0" step="0.000001" placeholder="0.0" class="amt" />
            <div style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap">
              <button class="btn sm approve" data-i18n="btn.approve">Approuver</button>
              <button class="btn sm stake" data-i18n="btn.stake">Staker</button>
            </div>
          </div>

          <div class="card plan" data-months="12" data-apy="20">
            <h3 style="margin:0">12 <span data-i18n="mo">mois</span> ‚Äî <b>20% APY</b></h3>
            <p class="muted" data-i18n="stake.lock12">Verrouillage 12 mois. Rendement maximum.</p>
            <label data-i18n="amount">Montant (NLY)</label>
            <input type="number" min="0" step="0.000001" placeholder="0.0" class="amt" />
            <div style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap">
              <button class="btn sm approve" data-i18n="btn.approve">Approuver</button>
              <button class="btn sm stake" data-i18n="btn.stake">Staker</button>
            </div>
          </div>
        </div>

        <!-- Encadr√© d'avertissement SamDoge-like -->
        <div id="stakeNotice" class="notice hidden" style="margin-top:14px">
          <b data-i18n="warn.title">Avertissement</b><br>
          <span class="muted" data-i18n="warn.samdoge">
            Pendant la p√©riode choisie, vos NLY sont verrouill√©s. Si vous laissez votre d√©p√¥t plus longtemps que la dur√©e s√©lectionn√©e, les r√©compenses n‚Äôaugmentent pas au-del√† de cette dur√©e : vous gagnez uniquement pour le plan choisi (3/6/9/12 mois). Les crypto-actifs sont volatils ‚Äî n‚Äôinvestissez que ce que vous pouvez vous permettre de perdre (DYOR).
          </span>
        </div>
      </section>

      <!-- Colonne droite : visible seulement connect√© -->
      <aside id="rightCol" class="hidden">
        <div class="card" style="margin-bottom:12px">
          <h3 style="margin:0 0 6px" data-i18n="wallet.title">Ton wallet</h3>
          <div class="muted" id="walletAddr">‚Äî</div>
          <div class="muted" id="walletNet">‚Äî</div>
          <hr style="border:none;border-top:1px solid var(--border);margin:12px 0">
          <div><small class="muted" data-i18n="wallet.balance">Solde NLY</small></div>
          <div id="nlyBalance"><b>‚Äî</b></div>
        </div>

        <div class="card" style="margin-bottom:12px">
          <h3 style="margin:0 0 6px" data-i18n="pos.title">Vos positions</h3>
          <div id="positions" class="muted" data-i18n="pos.empty">Aucune position pour le moment.</div>
        </div>

        <div class="panel">
          <h3 style="margin:0 0 6px" data-i18n="claim.title">R√©clamer & Retirer</h3>
          <label data-i18n="claim.id">ID de position</label>
          <input id="positionId" type="text" placeholder="#"/>
          <div style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap">
            <button class="btn sm ghost disabled" id="claimBtn" data-i18n="btn.claim">R√©clamer</button>
            <button class="btn sm disabled" id="exitBtn" data-i18n="btn.exit">Exit</button>
          </div>
        </div>
      </aside>
    </div>

    <!-- AVERTISSEMENT G√âN√âRAL (unique, comme index) -->
    <section class="container" id="disclaimer" style="padding:20px 0">
      <div class="panel">
        <h3 data-i18n="disc.title">Avertissement</h3>
        <p class="muted" data-i18n="disc.text">
          NellyCoin (NLY) est un jeton communautaire de type ‚Äúmeme coin‚Äù. Aucune garantie de performance ni de valeur future.
          Les crypto-actifs sont volatils et risqu√©s. Faites vos propres recherches (DYOR).
        </p>
      </div>
    </section>
  </main>

  <footer style="border-top:1px solid var(--border);padding:18px 0;color:var(--muted)">
    <div class="container" style="display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap">
      <div>¬© <span id="year"></span> NellyCoin ‚Äî <b data-i18n="foot.all">Tous droits r√©serv√©s</b>.</div>
      <div style="opacity:.85">Made with üß° ‚Ä¢ BSC ‚Ä¢ <a href="mailto:contact@nellycoin.io">contact@nellycoin.io</a></div>
    </div>
  </footer>

  <script>
    // ===== PWA
    if ('serviceWorker' in navigator) { window.addEventListener('load', () => { navigator.serviceWorker.register('/sw.js').catch(()=>{}); }); }

    // ===== SETTINGS
    const SETTINGS = {
      TOKEN_ADDRESS:'0x4bFfd4359a06583713df160da5817737654804b5', // contrat TOKEN NLY (pas staking)
      STAKING_ADDRESS:'', // sera ajout√© apr√®s d√©ploiement
      WC_PROJECT_ID:'REPLACE_WITH_YOUR_WALLETCONNECT_PROJECT_ID', // v2
      DEFAULT_LANG:(localStorage.getItem('nly_lang')||'fr'),
      OWNER:'0x7560Fdb9c6efd2bC58d0565173917Fd539064723',
      PANCAKE_URL:'https://pancakeswap.finance/swap?outputCurrency=0x4bFfd4359a06583713df160da5817737654804b5'
    };

    // ===== i18n
    const I18N={fr:{
      'nav.about':'√Ä propos','nav.tokenomics':'Tokenomics','nav.howto':'Comment acheter','nav.roadmap':'Feuille de route','nav.faq':'FAQ','nav.staking':'Staking','nav.links':'Liens','nav.buy':'Acheter NLY',
      'prep.msg':'üõ†Ô∏è Staking en cours de pr√©paration ‚Äî disponible prochainement.',
      'stake.enable':'Activer le staking','stake.disable':'D√©sactiver le staking','stake.title':'Plans de staking','stake.subtitle':'Choisissez une dur√©e. APY indicatif. Les r√©compenses se calculent sur la p√©riode.',
      'stake.lock3':'Verrouillage 3 mois. Id√©al pour d√©marrer.','stake.lock6':'Verrouillage 6 mois. Rendement √©quilibr√©.','stake.lock9':'Verrouillage 9 mois. Pour holders engag√©s.','stake.lock12':'Verrouillage 12 mois. Rendement maximum.',
      'mo':'mois','amount':'Montant (NLY)','btn.approve':'Approuver','btn.stake':'Staker','btn.connect':'Connecter','btn.disconnect':'D√©connecter','btn.claim':'R√©clamer','btn.exit':'Exit','btn.copy':'Copier',
      'how.title':'Comment d√©marrer ?','how.l1':'Connectez votre wallet (MetaMask / Binance Wallet / WalletConnect) sur BSC.','how.l2':'V√©rifiez le r√©seau (BSC Mainnet) et autorisez NLY pour le contrat de staking.','how.l3':'Choisissez un plan (3/6/9/12 mois) et entrez le montant.','how.l4':'Cliquez sur ‚ÄúApprouver‚Äù, puis ‚ÄúStaker‚Äù.','how.l5':'√Ä la fin de la p√©riode, utilisez ‚ÄúR√©clamer‚Äù ou ‚ÄúExit‚Äù.','how.warn':'‚ö†Ô∏è Connectez votre wallet pour acc√©der aux plans de staking.',
      'after.title':'Comment staker vos NLY ?','after.l1':'Choisissez un plan (3 / 6 / 9 / 12 mois).','after.l2':'Cliquez sur ‚ÄúApprouver‚Äù, puis sur ‚ÄúStaker‚Äù.','after.l3':'Validez la transaction dans votre wallet.','after.l4':'En fin de p√©riode, utilisez ‚ÄúR√©clamer‚Äù ou ‚ÄúExit‚Äù.',
      'wallet.title':'Ton wallet','wallet.balance':'Solde NLY',
      'pos.title':'Vos positions','pos.empty':'Aucune position pour le moment.',
      'claim.title':'R√©clamer & Retirer','claim.id':'ID de position',
      'addr.title':'Adresse du contrat NellyCoin (token, pas staking)','addr.note':'Ceci est l‚Äôadresse du jeton NLY. L‚Äôadresse du contrat de staking sera ajout√©e apr√®s d√©ploiement.',
      'warn.title':'Avertissement','warn.samdoge':'Pendant la p√©riode choisie, vos NLY sont verrouill√©s. Si vous laissez votre d√©p√¥t plus longtemps que la dur√©e s√©lectionn√©e, les r√©compenses n‚Äôaugmentent pas au-del√† de cette dur√©e : vous gagnez uniquement pour le plan choisi (3/6/9/12 mois). Les crypto-actifs sont volatils ‚Äî n‚Äôinvestissez que ce que vous pouvez vous permettre de perdre (DYOR).',
      'disc.title':'Avertissement','disc.text':'NellyCoin (NLY) est un jeton communautaire de type ‚Äúmeme coin‚Äù. Aucune garantie de performance ni de valeur future. Les crypto-actifs sont volatils et risqu√©s. Faites vos propres recherches (DYOR).',
      'foot.all':'Tous droits r√©serv√©s'
    },en:{
      'nav.about':'About','nav.tokenomics':'Tokenomics','nav.howto':'How to buy','nav.roadmap':'Roadmap','nav.faq':'FAQ','nav.staking':'Staking','nav.links':'Links','nav.buy':'Buy NLY',
      'prep.msg':'üõ†Ô∏è Staking is being prepared ‚Äî coming soon.',
      'stake.enable':'Enable staking','stake.disable':'Disable staking','stake.title':'Staking plans','stake.subtitle':'Pick a duration. Indicative APY. Rewards accrue over the period.',
      'stake.lock3':'3-month lock. Great to start.','stake.lock6':'6-month lock. Balanced yield.','stake.lock9':'9-month lock. For committed holders.','stake.lock12':'12-month lock. Maximum yield.',
      'mo':'months','amount':'Amount (NLY)','btn.approve':'Approve','btn.stake':'Stake','btn.connect':'Connect','btn.disconnect':'Disconnect','btn.claim':'Claim','btn.exit':'Exit','btn.copy':'Copy',
      'how.title':'How to start?','how.l1':'Connect your wallet (MetaMask / Binance Wallet / WalletConnect) on BSC.','how.l2':'Check the network (BSC Mainnet) and approve NLY for the staking contract.','how.l3':'Pick a plan (3/6/9/12 months) and enter the amount.','how.l4':'Click ‚ÄúApprove‚Äù, then ‚ÄúStake‚Äù.','how.l5':'At term, use ‚ÄúClaim‚Äù or ‚ÄúExit‚Äù.','how.warn':'‚ö†Ô∏è Connect your wallet to access staking plans.',
      'after.title':'How to stake your NLY?','after.l1':'Choose a plan (3 / 6 / 9 / 12 months).','after.l2':'Click ‚ÄúApprove‚Äù, then ‚ÄúStake‚Äù.','after.l3':'Confirm the transaction in your wallet.','after.l4':'At maturity, use ‚ÄúClaim‚Äù or ‚ÄúExit‚Äù.',
      'wallet.title':'Your wallet','wallet.balance':'NLY balance',
      'pos.title':'Your positions','pos.empty':'No positions yet.',
      'claim.title':'Claim & Withdraw','claim.id':'Position ID',
      'addr.title':'NellyCoin contract address (token, not staking)','addr.note':'This is the NLY token address. The staking contract address will be added after deployment.',
      'warn.title':'Disclaimer','warn.samdoge':'During the chosen period, your NLY are locked. If you keep the deposit longer than the selected duration, rewards do not increase beyond that: you only earn for the chosen plan (3/6/9/12 months). Crypto assets are volatile ‚Äî invest only what you can afford to lose (DYOR).',
      'disc.title':'Disclaimer','disc.text':'NellyCoin (NLY) is a community meme coin. No guarantee of performance or future value. Crypto assets are volatile and risky. Do your own research (DYOR).',
      'foot.all':'All rights reserved'
    }};
    const i18n={lang:SETTINGS.DEFAULT_LANG,t:(k)=> (I18N[i18n.lang]&&I18N[i18n.lang][k])||I18N.fr[k]||k,apply(){document.querySelectorAll('[data-i18n]').forEach(el=>{const k=el.getAttribute('data-i18n');const v=i18n.t(k);if(v)el.innerHTML=v;});},set(l){i18n.lang=l;localStorage.setItem('nly_lang',l);i18n.apply();}};

    // ===== Helpers
    const $=s=>document.querySelector(s), $$=s=>document.querySelectorAll(s);
    function short(a){return a? a.slice(0,6)+'‚Ä¶'+a.slice(-4):'‚Äî'}

    // ===== Wallet state
    const wallet={provider:null,type:null,addr:null,chainId:null,connected:false};
    function renderWallet(){ $('#walletAddr').textContent=wallet.addr?short(wallet.addr):'‚Äî'; $('#walletNet').textContent=wallet.chainId===56?'BSC Mainnet':(wallet.chainId===97?'BSC Testnet':'‚Äî'); }
    function updateAdminUI(){ const t=$('#toggleStake'); if(!wallet.addr){t.classList.add('hidden');return;} (wallet.addr.toLowerCase()===SETTINGS.OWNER.toLowerCase())?t.classList.remove('hidden'):t.classList.add('hidden'); }
    function onConnectUI(){
      wallet.connected=true;
      $('#plansWrap').classList.remove('hidden');
      $('#stakeNotice').classList.remove('hidden');
      $('#rightCol').classList.remove('hidden');
      $('#howBefore').classList.add('hidden');
      $('#howAfter').classList.remove('hidden');
    }
    function onDisconnectUI(){
      wallet.connected=false;
      $('#plansWrap').classList.add('hidden');
      $('#stakeNotice').classList.add('hidden');
      $('#rightCol').classList.add('hidden');
      $('#howBefore').classList.remove('hidden');
      $('#howAfter').classList.add('hidden');
      $('#nlyBalance').innerHTML='‚Äî';
      renderWallet(); updateAdminUI();
    }

    // ===== Balance (ERC-20)
    async function getTokenBalance(){ if(!wallet.provider||!wallet.addr) return; const data='0x70a08231000000000000000000000000'+wallet.addr.replace('0x',''); const res=await wallet.provider.request({method:'eth_call',params:[{to:SETTINGS.TOKEN_ADDRESS,data},'latest']}); const bal=parseInt(res,16); return isNaN(bal)?'0.0000':(bal/1e18).toFixed(4); }
    async function refreshBalances(){ const n=await getTokenBalance(); $('#nlyBalance').innerHTML=n?('<b>'+n+' NLY</b>'):'‚Äî'; }

    // ===== Modal wallets
    const modal=document.createElement('div'); modal.className='modal'; modal.innerHTML=`<div class="box"><div style="display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:10px"><h3 style="margin:0">Choisir un portefeuille</h3><button class="btn sm ghost" id="closeModal">‚úï</button></div><div class="wallet-list"><button class="wallet-btn" id="chooseMM">ü¶ä MetaMask</button><button class="wallet-btn" id="chooseBW">üíº Binance Wallet</button><button class="wallet-btn" id="chooseWC">üì± WalletConnect</button></div></div>`; document.body.appendChild(modal);
    function openModal(){ modal.classList.add('open'); } function closeModal(){ modal.classList.remove('open'); }

    // ===== Connectors
    async function connectMetaMask(){ const eth=window.ethereum; if(!eth){alert('MetaMask non d√©tect√©.');return;} const accounts=await eth.request({method:'eth_requestAccounts'}); const chainId=await eth.request({method:'eth_chainId'}); wallet.provider=eth; wallet.type='metamask'; wallet.addr=accounts[0]; wallet.chainId=parseInt(chainId,16); renderWallet(); updateAdminUI(); onConnectUI(); refreshBalances(); eth.on?.('accountsChanged',(a)=>{wallet.addr=a?.[0]||null; if(wallet.addr){onConnectUI();} else {onDisconnectUI();} renderWallet(); refreshBalances(); updateAdminUI();}); eth.on?.('chainChanged',(cid)=>{wallet.chainId=parseInt(cid,16);renderWallet();}); }
    async function connectBinanceWallet(){ const bw=window.BinanceChain; if(!bw){alert('Binance Wallet non d√©tect√©.');return;} const accounts=await bw.request({method:'eth_requestAccounts'}); const chainId=await bw.request({method:'eth_chainId'}); wallet.provider=bw; wallet.type='binance'; wallet.addr=accounts[0]; wallet.chainId=parseInt(chainId,16); renderWallet(); updateAdminUI(); onConnectUI(); refreshBalances(); bw.on?.('accountsChanged',(a)=>{wallet.addr=a?.[0]||null; if(wallet.addr){onConnectUI();} else {onDisconnectUI();} renderWallet(); refreshBalances(); updateAdminUI();}); bw.on?.('chainChanged',(cid)=>{wallet.chainId=parseInt(cid,16);renderWallet();}); }

    // WalletConnect v2 preferred, v1 fallback
    async function connectWalletConnect(){
      if (window.WalletConnectEthereumProvider){ // v2
        try{
          const provider = await window.WalletConnectEthereumProvider.init({
            projectId: SETTINGS.WC_PROJECT_ID,
            chains: [56],
            showQrModal: true,
            methods:['eth_sendTransaction','eth_signTransaction','eth_sign','personal_sign','eth_signTypedData','eth_requestAccounts'],
          });
          await provider.enable();
          const accounts=await provider.request({method:'eth_accounts'}); const chainId=await provider.request({method:'eth_chainId'});
          wallet.provider=provider; wallet.type='walletconnect'; wallet.addr=accounts[0]; wallet.chainId=parseInt(chainId,16);
          renderWallet(); updateAdminUI(); onConnectUI(); refreshBalances();
          provider.on('accountsChanged',(a)=>{wallet.addr=a?.[0]||null; if(wallet.addr){onConnectUI();} else {onDisconnectUI();} renderWallet(); refreshBalances(); updateAdminUI();});
          provider.on('chainChanged',(cid)=>{wallet.chainId=parseInt(cid,16);renderWallet();});
          provider.on('disconnect',()=>{disconnect();});
          return;
        }catch(e){ console.warn('WC v2 error, trying v1', e); }
      }
      if (window.WalletConnectProvider){ // v1 fallback
        try{
          const WC1 = window.WalletConnectProvider.default || window.WalletConnectProvider;
          const provider = new WC1({ rpc:{56:"https://bsc-dataseed.binance.org/"}, chainId:56, qrcode:true });
          await provider.enable();
          const accounts=provider.accounts; const chainId=provider.chainId;
          wallet.provider=provider; wallet.type='walletconnect-v1'; wallet.addr=accounts[0]; wallet.chainId=chainId;
          renderWallet(); updateAdminUI(); onConnectUI(); refreshBalances();
          provider.on('accountsChanged',(a)=>{wallet.addr=a?.[0]||null; if(wallet.addr){onConnectUI();} else {onDisconnectUI();} renderWallet(); refreshBalances(); updateAdminUI();});
          provider.on('chainChanged',(cid)=>{wallet.chainId=Number(cid);renderWallet();});
          provider.on('disconnect',()=>{disconnect();});
          return;
        }catch(e){ alert('WalletConnect indisponible.'); return; }
      }
      alert('SDK WalletConnect indisponible.');
    }

    function disconnect(){
      try{
        if(wallet.type==='walletconnect' && wallet.provider?.disconnect){ wallet.provider.disconnect(); }
        if(wallet.type==='walletconnect-v1' && wallet.provider?.disconnect){ wallet.provider.disconnect(); }
      }catch(_){}
      wallet.provider=null; wallet.type=null; wallet.addr=null; wallet.chainId=null;
      onDisconnectUI();
    }

    // ===== Staking UI toggle (admin only)
    let stakingEnabled=false;
    function applyStakingState(){
      const st=$('#stakingStatus'); const btn=$('#toggleStake');
      if(stakingEnabled){ st.classList.remove('warn'); st.classList.add('ok'); st.textContent=i18n.t('stake.disable'); btn.innerHTML='üîí '+i18n.t('stake.disable'); }
      else{ st.classList.remove('ok'); st.classList.add('warn'); st.textContent=i18n.t('prep.msg'); btn.innerHTML='üîì '+i18n.t('stake.enable'); }
    }

    // ===== Events
    $('#year').textContent=(new Date()).getFullYear();
    $('#buyBtn').href=SETTINGS.PANCAKE_URL;

    const langSel=$('#lang'); langSel.value=i18n.lang; langSel.addEventListener('change',e=>i18n.set(e.target.value));
    i18n.apply();

    $('#menuToggle').addEventListener('click',()=> $('#mainNav').classList.toggle('open'));
    $('#connectBtn').addEventListener('click',()=> modal.classList.add('open'));
    $('#disconnectBtn').addEventListener('click',disconnect);
    modal.querySelector('#closeModal').addEventListener('click',()=> modal.classList.remove('open'));
    modal.querySelector('#chooseMM').addEventListener('click',async()=>{modal.classList.remove('open'); await connectMetaMask();});
    modal.querySelector('#chooseBW').addEventListener('click',async()=>{modal.classList.remove('open'); await connectBinanceWallet();});
    modal.querySelector('#chooseWC').addEventListener('click',async()=>{modal.classList.remove('open'); await connectWalletConnect();});

    $('#toggleStake').addEventListener('click',()=>{ if(wallet.addr?.toLowerCase()!==SETTINGS.OWNER.toLowerCase()) return; stakingEnabled=!stakingEnabled; applyStakingState(); });

    // Copy token
    $('#copyToken').addEventListener('click',async()=>{try{await navigator.clipboard.writeText(SETTINGS.TOKEN_ADDRESS);const b=$('#copyToken');const old=b.innerHTML;b.innerHTML='‚úÖ '+i18n.t('btn.copy');setTimeout(()=>b.innerHTML=old,1100);}catch(_){};});

    // Boot
    renderWallet(); updateAdminUI(); applyStakingState(); onDisconnectUI(); // ensure correct initial visibility
  </script>
</body>
</html>

